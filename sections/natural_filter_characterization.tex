\section{Characterizing the Natural Filter}
\label{sec:natural_filter_characterization}

Our goal is to study when the natural filter \Cref{alg:natural_filter} with budget $B$ and queries in $\cL$ comes at no additional privacy cost, i.e. the mechanism induced by the interaction between the filter and an adversarial analyst itself has privacy bounded by $B$. In this case, we say that the natural filter is free. For simplicity, we will assume that $\Iddist \in \cL$. We also denote by $\cL^\infty$ the closure of $\cL$ under convolution.

\begin{algorithm}[tb]
	\caption{NaturalFilter}
	\label{alg:natural_filter}
	\begin{algorithmic}
		\REQUIRE Privacy budget $B$, analyst $\cA$, family of allowed PLDs $\cL$, query capacity $k$, dataset $D$
		\FOR{$i = 1, \dots, k$}
			\STATE $\cA$ gives mechanism $\cM_i$ that has PLD $L_i \in \cL$ \algcomment{can depend on previous results $Y_{<i}$}
			\IF{$L_1 \oplus \dots \oplus L_i \preceq B$ and no $Y_j = \bot, j < i$}
				\STATE $\cA$ receives $Y_i \sim \cM_i(D)$
			\ELSE
				\STATE $\cA$ receives $Y_i = \bot$
			\ENDIF
		\ENDFOR
		\RETURN $(Y_1, \ldots, Y_k)$
	\end{algorithmic}
\end{algorithm}

Now, notice that the natural filter \Cref{alg:natural_filter} with budget $B$ and $k$ queries in $\cL$ is free exactly when $\pld(\Filter_{\cL, B, k}) \preceq B$ where
\begin{align*}
	\Filter_{\cL, B, k}(L_1, \dots, L_{k'})
		:= \{L_{k' + 1} \in \cL : L_1 \oplus \dots \oplus L_{k'} \oplus L_{k' + 1} \preceq B\}
\end{align*}
for $0 \leq k' < k$. In particular, by applying \Cref{lemma:restricted_adversary} to the rule $\Filter_{\cL, B, k}$ we immediately get the following characterization.

\begin{theorem}
	\label{thm:free_natural_filter}
	Let $\cL$ be a family of PLDs, $B$ a PLD, and $k > 0$. For any $L_1, \dots, L_{i} \in \cL$, let
	\begin{align*}
		V_{k - i}(L_1, \dots, L_{i}) := \sup\{L_{i + 1} \oplus V_{k - (i + 1)}(L_1, \dots, L_{i + 1}) : L_{i + 1} \in \cL, L_1 \oplus \dots \oplus L_{i + 1} \preceq B\}
	\end{align*}
	where $V_0(L_1, \dots, L_k) := \Iddist$. The natural filter for $k$ queries in $\cL$ with budget $B$ is free iff $V_k(\lambda) \preceq B$.
\end{theorem}

Informally, $V_{k - i}(L_1, \dots, L_{i})$ is the maximal remaining privacy cost of an adversary that has already played moves $L_1, \dots, L_{i}$. Naturally, when the adversary has already selected all of its moves, the remaining privacy cost is $\Iddist$, i.e. nothing.

It is also of interest to understand when a given family of queries $\cL$ simultaneously admits free natural filters against an arbitrary budget $B$. It turns out that this is the case exactly when the supremum commutes with the convolution operator.

\begin{theorem}
	\label{thm:universal_free_natural_filter}
	Fix a family of PLDs $\cL$ and a query capacity $k$. The natural filter \Cref{alg:natural_filter} is free for choices of budgets $B$ if and only if
	\begin{align*}
		\forall L \in \cL \ \textrm{and} \ \cL' \subseteq \cL^{\infty} \quad
			L \oplus \sup{\cL'} = \sup\{L \oplus L' : L' \in \cL'\}.
	\end{align*}
\end{theorem}

Our key result is that that this commutativity condition can essentially only be satisfied when $\cL^\infty$ is well-ordered.

\begin{theorem}
	\label{thm:well_ordering}
	Fix a family of non-degenerate PLDs $\cL$, i.e. every $L \in \cL$ is supported at at least two points in $\bR$. The natural filter \Cref{alg:natural_filter} is free for every budget $B$ and every query capacity $k$ if and only if $\cL^\infty$ is well-ordered with respect to $\preceq$.
\end{theorem}

It is straightforward to show that families of queries that are well-ordered under composition satisfy the commutativity condition of \Cref{thm:universal_free_natural_filter}. The reverse direction is significantly more challenging. The key technical idea is that any PLD whose support can be shifted to hit gaps between other PLDs causes those gaps to align when composed. By analyzing the topology of a pair of privacy profiles that are not well-ordered, one can show that this support shifting condition is satisfied.
